setTCPRecvTimeout(4)
--setTCPSendTimeout(5)

setLocal("0.0.0.0:53")
setACL("0.0.0.0/0")

-- Function to delay and then spoof
local function delayedSpoof(dq)
    -- Only act on TCP
    if dq.tcp then
        -- Sleep for 1 second (1000 milliseconds)
        os.execute("sleep 1")
        -- Return a spoofed A record
        return DNSAction.Spoof, "1.2.3.4"
    end
    -- If UDP, just let it pass or use normal action
    return DNSAction.None
end

-- Add rule: If query is for example.com, apply the custom function
-- addAction(AllRule(), LuaAction(delayedSpoof))

addAction(AllRule(), SpoofAction('1.2.3.4'))
